# final project 중간 과정 공유


## 1. 문제 정의

- 종족 선택
    - 종족은 상대적으로 난이도가 있는 protoss를 선택함
- state 정의
    - 나의 유닛 정보, 적 유닛 정보를 모은 1차원 텐서를 state input으로 정의
    - 처음에는 적이 생산가능한 모든 유닛을 state정보에 넣으면 학습이 어려울 것으로 생각되어 
    주로 생산하는 유닛만 넣었으나, state에 고려하지 않은 unit이 주력으로 나오면 무기력하게 패배
        - ex: 마린과 탱크, 레이븐 정도만 고려한 상황에서 헬리온이 주력으로 나오는 게임은 너무 쉽게 패배함
    - 자원 상황은 state에 넣지 않아도 자원을 미사용하고 남는 경우가 없어 고려하지 않음
- action 정의
    - 고급 유닛 생산을 위해서는 vespene가스의 채취가 필수
    - protoss의 assimilator 건설 및 고급유닛 생산을 action에 추가
    - harvest vespene action 추가

## 2. 어려운 점

- vespene 가스 채취
    - assimilator건설 후 일꾼을 랜덤하게 미네랄 또는 베스핀 가스 채취로 보내는 경우
    일꾼이 assilmilator에 몰려서 미네랄을 채취하지 못하는 경우 발생
- 일꾼 생산
    - 일꾼이 공격유닛보다 지나치게 많이 생산되면 자원 잉여의 문제 발생
- 앞마당 멀티
    - 컴퓨터의 난이도가 올라가면 앞마당 멀티를 가져가는데, 이때 Agent도 멀티를 가져가지 않으면    
    자원과 병력 차이로 쉽게 져서 초반 러쉬 말고는 이길수가 없게 됨
    - 앞마당 멀티의 위치를 잡기가 쉽지 않음
- 건물 위치
    - 건물의 위치를 지정하기가 쉽지 않음
    - 프로토스의 경우 파일런의 위치를 고려해야 함
- 공격 위치
    - 공격 위치를 상대방 진영으로만 설정하면 멀티의 구석에 있는 건물을 공격하지 못하는 현상 발생
    - 결국 경기를 다 이기고도 0점을 얻는 상황이 생김

## 3. DQN 네트워크 구현

- input과 output이 단순한 만큼 Naive Perceptron을 그대로 적용
- hidden size 128과 256을 비교해 본 결과 128이 상대적으로 학습이 더 잘됨
    - 이유는 input과 output의 size가 크지 않기 때문에 오히려 복잡한 네트워크로 구현하면
    학습 시간만 오래걸리고 효율이 떨어짐
- [수정] hidden size를 단순하게 잡았더니 전혀 학습이 되지 않음
이에 따라 [128, 64] 사이즈로 weight matrix를 잡고 학습을 진행한 결과 학습이 되는 것 같은 느낌을 받음
- 빠르게 학습시키기 위해 learning rate를 0.001로 잡음
![tensorboard](./tensorboard.png)
    - 여러 파라메터를 바꿔가면서 학습 테스트 중

## 4. pysc2 API를 활용한 문제 해결

- 자원 채취의 경우 nexus와 assimilator의 ideal_harvesters와 assigned_harvesters 속성을 활용
  하여 과다하게 배치되지 않도록 하고 일꾼을 지나치게 생산하지 않도록 제한함
- 프로토스의 경우 건물들이 파일런 주위에 지어져야 하는데, 파일런이 없으면 건물 짓는 액션을 수행해도
  Agent입장에서는 no_op을 리턴받으므로 학습할수록 파일런만 찍어내는 문제가 생김
  - 이를 방지하기 위해 잉여 food가 10이하일때만 파일런을 설치하도록 제한함
- 앞마당 멀티의 경우 vespene gas의 위치를 찾아 넥서스를 짓도록 함
  이렇게 하면 다른 맵에서도 유사한 로직을 적용할 수 있을 것으로 기대함
- 공격 위치가 매우 중요한데, 공격 위치를 너무 넓게 설정하면 공격 명령을 내려도 적 기지를 제대로 타격하지 못하는 경우가 생김
이 때 Agent는 공격 명령에 대한 명확한 reward를 받지 못하기 때문에 제대로 학습이 되지 않음
    - 적 기지만 타격하게 하는 경우에는 멀티를 공격하지 못하는 현상이 발생
    - 이 문제는 결국 해결하지 못하고 적 기지와 멀티 위치를 지정하여 랜덤하게 공격하는 것으로 함
- 건물 위치의 경우에도 파일런과 게이트웨이, 넥서스 위치를 기준으로 짓도록 되어 있는데
  위치기준으로 짓다 보니 간혹 엉뚱한 위치에 건물이 지어져서 유닛이 빠져 나오지 못하거나 하는 현상이 발생
  이를 해결하기 위해서는 어쩔수없이 visual image를 인풋으로 받아서 Agent에게 건물 위치 또는 Attack 위치를 학습시키는 방법 이외에는 없어 보임
  

    
    
    